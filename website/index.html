<!DOCTYPE html>
<html>

<head>
    <title>Favorite Cat Viewer</title>
</head>

<body>
    <img id="catImg" src="" width="300" />
    <br><br>

    <button id="prevCat">Previous Cat</button>
    <button id="nextCat">Next Cat</button>
    <br><br>

    <button id="saveCat">Save cat</button>

    <script>
        const apiUrl = "https://d8qhnywrq0.execute-api.eu-central-1.amazonaws.com/prod/saveCat";

        let catHistory = [];
        let currentIndex = -1;

        const showCat = (url) => {
            document.getElementById("catImg").src = url;
        };

        const fetchCat = async () => {
            const res = await fetch("https://cataas.com/cat?json=true");
            const data = await res.json();

            const newUrl = `https://cataas.com/cat/${data.id}`;
            catHistory.push({ catId: data.id, url: newUrl });
            currentIndex = catHistory.length - 1;
            showCat(newUrl);
        };

        fetchCat();

        document.getElementById("nextCat").onclick = () => {
            if (currentIndex < catHistory.length - 1) {
                currentIndex++;
                showCat(catHistory[currentIndex].url);
            } else {
                fetchCat();
            }
        };

        document.getElementById("prevCat").onclick = () => {
            if (currentIndex > 0) {
                currentIndex--;
                showCat(catHistory[currentIndex].url);
            }
        };

        document.getElementById("saveCat").onclick = async () => {
            if (currentIndex === -1) return alert("No cat to save!");

            const { catId, url } = catHistory[currentIndex];

            const result = await fetch(`${apiUrl}`, {
                method: 'POST',
                headers: {
                    
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ catId, savedUrl: url })
            });

            const data = await result.json();
            alert(data.message);
        };
    </script>
</body>

</html>